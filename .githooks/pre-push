#!/bin/sh
# Hook pour valider les noms de branches avant push

# Récupérer le nom de la branche actuelle
branch=$(git rev-parse --abbrev-ref HEAD)

# Regex pour valider le nom de branche
valid_pattern="^(feat|fix|chore|docs|refactor|test)\/[a-z0-9-]+$"

# Branches spéciales autorisées
if [ "$branch" = "main" ] || [ "$branch" = "develop" ] || [ "$branch" = "master" ]; then
    exit 0
fi

# Vérifier le format
if ! echo "$branch" | grep -qE "$valid_pattern"; then
    echo "❌ Nom de branche invalide: $branch"
    echo ""
    echo "Format requis: type/description-en-kebab-case"
    echo "Types valides: feat, fix, chore, docs, refactor, test"
    echo ""
    echo "Exemples valides:"
    echo "  feat/add-user-authentication"
    echo "  fix/memory-leak-issue"
    echo "  chore/update-dependencies"
    echo "  docs/api-documentation"
    echo ""
    echo "Pour renommer votre branche:"
    echo "  git branch -m $branch <nouveau-nom>"
    echo ""
    exit 1
fi

echo "✅ Nom de branche valide: $branch"
exit 0